<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Averaging-Rechner</title>
  <style>
    :root { --bg:#0b0f14; --card:#121820; --muted:#8aa0b2; --text:#eaf2f9; --accent:#5dd0ff; }
    html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font:16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial;}
    .wrap{max-width:680px;margin:0 auto;padding:16px;}
    header{display:flex;align-items:center;gap:10px;margin:8px 0 16px}
    header h1{font-size:1.2rem;margin:0}
    .card{background:var(--card);border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.35);padding:16px;margin-bottom:12px;border:1px solid rgba(255,255,255,.06)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    label{display:block;font-size:.85rem;color:var(--muted);margin-bottom:6px}
    input{width:100%;box-sizing:border-box;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:#0e131a;color:var(--text);padding:12px;outline:none}
    input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(93,208,255,.15)}
    .muted{color:var(--muted);font-size:.9rem}
    .btn{width:100%;padding:14px 16px;border-radius:12px;border:0;background:var(--accent);color:#001019;font-weight:700;margin-top:8px;cursor:pointer}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .metric{background:#0f141b;border:1px solid rgba(255,255,255,.06);border-radius:14px;padding:12px}
    .metric .k{color:var(--muted);font-size:.8rem}
    .metric .v{font-size:1.05rem;font-weight:700;margin-top:2px}
    textarea{width:100%;min-height:120px;box-sizing:border-box;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:#0e131a;color:var(--text);padding:12px}
    .hint{font-size:.85rem;color:var(--muted)}
    .footer{opacity:.7;font-size:.8rem;margin-top:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3 3v18h18" stroke="#5dd0ff" stroke-width="2"/><path d="M5 15l4-6 4 3 4-6 3 5" stroke="#5dd0ff" stroke-width="2" fill="none"/>
      </svg>
      <h1>Averaging‑Rechner (50/50 @ Entry & Entry+0,5%)</h1>
    </header>

    <div class="card">
      <div class="row">
        <div>
          <label>Entry‑Preis</label>
          <input id="entry" type="number" step="0.00000001" value="100" />
        </div>
        <div>
          <label>Stop‑Loss‑Preis</label>
          <input id="stop" type="number" step="0.00000001" value="95" />
        </div>
      </div>
      <div class="row" style="margin-top:12px">
        <div>
          <label>Gewünschtes Risiko ($)</label>
          <input id="risk" type="number" step="0.01" value="25" />
        </div>
        <div>
          <label>Gebührensatz (%) pro Seite (optional)</label>
          <input id="fee" type="number" step="0.0001" value="0" />
        </div>
      </div>
      <div class="row" style="margin-top:12px">
        <div>
          <label>Tick Size (Preis‑Raster, optional)</label>
          <input id="tick" type="number" step="0.00000001" value="0" />
        </div>
        <div>
          <label>Lot Size (Mengen‑Raster, optional)</label>
          <input id="lot" type="number" step="0.00000001" value="0" />
        </div>
      </div>
      <button class="btn" id="calc">Berechnen</button>
      <p class="hint">Long‑Logik: 50% bei Entry, 50% bei Entry × 1,005 → Ø‑Entry (Soll) = Entry × 1,0025.</p>
    </div>

    <div class="grid">
      <div class="metric"><div class="k">Limit #1 Preis</div><div class="v" id="m_p1">–</div></div>
      <div class="metric"><div class="k">Limit #2 Preis</div><div class="v" id="m_p2">–</div></div>
      <div class="metric"><div class="k">Ø Entry (Soll)</div><div class="v" id="m_avg">–</div></div>
      <div class="metric"><div class="k">Qty #1</div><div class="v" id="m_q1">–</div></div>
      <div class="metric"><div class="k">Qty #2</div><div class="v" id="m_q2">–</div></div>
      <div class="metric"><div class="k">Ø Entry (effektiv)</div><div class="v" id="m_avg_eff">–</div></div>
    </div>

    <div class="card">
      <label>Order‑Details (zum Kopieren)</label>
      <textarea id="out" readonly></textarea>
      <p class="footer">Hinweis: Vereinfachtes Modell (keine Slippage/Funding/Partials &neq; 50/50). Runde Tick/Lot passend zu deiner Börse.</p>
    </div>
  </div>

<script>
function fmt(n, d=8){ return Number(n).toFixed(d); }
function roundToStep(x, step, dir){
  step = Number(step);
  if (!step || step <= 0) return x;
  const k = x / step;
  if (dir === 'up') return Math.ceil(k - 1e-12) * step;
  if (dir === 'down') return Math.floor(k + 1e-12) * step;
  return Math.round(k) * step;
}

function calc(){
  const entry = Number(document.getElementById('entry').value);
  const stop  = Number(document.getElementById('stop').value);
  const risk  = Number(document.getElementById('risk').value);
  const feePct= Number(document.getElementById('fee').value)/100;
  const tick  = Number(document.getElementById('tick').value);
  const lot   = Number(document.getElementById('lot').value);

  if(!(entry>0 && stop>0 && risk>0)){
    alert('Bitte gültige, positive Werte eingeben.');
    return;
  }

  const p1 = entry;
  const p2 = entry * 1.005;
  const avg = entry * 1.0025;

  // simple fee impact estimate: (avg entry for entries + stop) * fee rate
  const feeImpact = feePct>0 ? (((p1+p2)/2 + stop) * feePct) : 0;
  let riskPerUnit = Math.max(avg - stop, 0) + feeImpact;
  if(riskPerUnit<=0){ alert('Stop muss unter dem Ø‑Entry liegen.'); return; }

  const totalQty = risk / riskPerUnit;
  let q1 = totalQty/2, q2 = totalQty/2;
  q1 = roundToStep(q1, lot, 'down');
  q2 = roundToStep(q2, lot, 'down');

  let price1 = roundToStep(p1, tick);
  let price2 = roundToStep(p2, tick);

  const not1 = price1 * q1, not2 = price2 * q2;
  const effQty = (q1+q2)>0 ? (q1+q2) : 1e-12;
  const avgEff = (not1+not2) / effQty;

  const feeImpactEst = feePct>0 ? (((price1+price2)/2 + stop) * feePct) : 0;
  const effRiskPerUnit = Math.max(avgEff - stop, 0) + feeImpactEst;
  const effRisk = effRiskPerUnit * (q1+q2);

  document.getElementById('m_p1').textContent = fmt(price1);
  document.getElementById('m_p2').textContent = fmt(price2);
  document.getElementById('m_avg').textContent = fmt(avg);
  document.getElementById('m_q1').textContent = fmt(q1);
  document.getElementById('m_q2').textContent = fmt(q2);
  document.getElementById('m_avg_eff').textContent = fmt(avgEff);

  const txt = `LIMIT #1: Preis ${fmt(price1)}, Menge ${fmt(q1)}\n`+
              `LIMIT #2: Preis ${fmt(price2)}, Menge ${fmt(q2)}\n`+
              `Stop-Loss: ${fmt(stop)}\n`+
              `Ø Entry (Soll): ${fmt(avg)} | Ø Entry (effektiv): ${fmt(avgEff)}\n`+
              `Geschätztes Risiko: $${effRisk.toFixed(2)}`;
  document.getElementById('out').value = txt;
}

document.getElementById('calc').addEventListener('click', calc);
window.addEventListener('load', calc);
</script>
</body>
</html>
